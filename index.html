<!doctype html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CRM revamp 2026 </title>
  <link rel="stylesheet" href="./assets/css/styles.css" />
</head>

<body>
  <main class="app">
    <aside class="card sidebar" aria-label="Screens">
      <header>
        <h1 class="title">Clickable Wireframe</h1>
        <p class="subtitle">Click tabs to move between screens. Click text to edit.</p>
      </header>

      <nav class="nav" id="nav">
        <button data-go="dashboard" aria-current="page">
          <span class="label"><strong>Dashboard</strong><span>Main hub</span></span>
         <!-- <span class="pill"Home</span> -->
        </button>
        <button data-go="accounts">
          <span class="label"><strong>Accounts</strong><span>Customer list</span></span>
          <span class="pill">S2</span>
        </button>
        <button data-go="leads">
          <span class="label"><strong>Leads</strong><span>New + nurture</span></span>
          <span class="pill">S3</span>
        </button>
        <button data-go="pipeline">
          <span class="label"><strong>Pipeline</strong><span>Opportunities + stages</span></span>
          <span class="pill">S4</span>
        </button>
        <button data-go="reporting">
          <span class="label"><strong>Reporting</strong><span>KPIs + trends</span></span>
          <span class="pill">S5</span>
        </button>
        <button data-go="admin">
          <span class="label"><strong>Admin</strong><span>Mgmt tools</span></span>
          <span class="pill">S6</span>
        </button>
        <button data-go="settings">
          <span class="label"><strong>Settings</strong><span>Preferences</span></span>
          <span class="pill">S7</span>
        </button>
      </nav>

      <div style="padding: 0 18px 18px;">
        <div class="hint">
          <strong>Editing tips:</strong>
          <ul style="margin: 8px 0 0; padding-left: 18px;">
            <li>Click any highlighted text area to edit it.</li>
            <li>Press <strong>Enter</strong> to finish editing that field.</li>
            <li>Your edits persist (saved in this browser).</li>
          </ul>
        </div>
      </div>
    </aside>

    <section class="card content" aria-label="Prototype">
    <header class="header-bar">
  <div class="brand">Stevia CRM</div>

  <div class="header-utils">
    <div class="top-tabs">
      <button class="tab" data-go="dashboard">Dashboard</button>
      <button class="tab" data-go="accounts">Accounts</button>
      <button class="tab" data-go="leads">Leads</button>
      <button class="tab" data-go="pipeline">Pipeline</button>
      <button class="tab" data-go="reporting">Reporting</button>
      <button class="tab" data-go="admin">Admin</button>
    </div>


          <div class="top-tabs" aria-label="Top navigation">
          </div>
          <div class="header-utils">
</div>


        </div>
         <!-- 
        <div class="actions">
         
          <button class="btn" id="backBtn" type="button">Back</button>
          <button class="btn" id="resetBtn" type="button">Reset</button>
          <button class="btn" id="themeBtn" type="button">Theme</button> 
          <button class="btn primary" id="toggleNotesBtn" type="button">Toggle Notes</button>
        </div>-->
      </header>

            <div class="screen-wrap" id="screens">
        <!-- DASHBOARD (landing) -->
        <section class="screen" id="dashboard" data-pill="Home">
<div class="grid" style="margin-top: 12px;">

  <!-- LEFT: Today's Meetings -->
  <div class="panel">
    <h3 style="margin:0 0 10px;font-size:14px;" class="editable" contenteditable="true" data-edit-id="dash_meetings_h3">Today’s Meetings</h3>
    <span class="pill" style="float:right; margin-top:-28px;">Wednesday, Jan 14th</span>

    <div class="list">
      <div class="item" role="button" tabindex="0" data-action="toast" data-message="Join Intro meeting">
        <span class="chk" aria-hidden="true" style="opacity:0"></span>
        <div class="item-main">
          <div class="item-title editable" contenteditable="true" data-edit-id="mtg1_title">Technical Discovery - Northbound Labs - Marina Wells</div>
          <div class="item-meta editable" contenteditable="true" data-edit-id="mtg1_meta">+amceachern</div>
        </div>
        <div class="item-right">
          <button class="mini right-cta editable" contenteditable="true" data-edit-id="mtg1_cta" type="button" data-action="toast" data-message="Join">10:00AM </button>
        </div>
      </div>

      <div class="item" role="button" tabindex="0" data-action="toast" data-message="Prep Discovery follow-up">
        <span class="chk" aria-hidden="true" style="opacity:0"></span>
        <div class="item-main">
          <div class="item-title editable" contenteditable="true" data-edit-id="mtg2_title"> Discovery Call - Wakefield Tech - Sandy Banks</div>
          <div class="item-meta editable" contenteditable="true" data-edit-id="mtg2_meta"></div>
        </div>
        <div class="item-right">
          <button class="mini right-cta editable" contenteditable="true" data-edit-id="mtg2_cta" type="button" data-action="toast" data-message="Prep">2:00PM </button>
        </div>
      </div>

      <div class="item" role="button" tabindex="0" data-action="toast" data-message="Open Internal alignment notes">
        <span class="chk" aria-hidden="true" style="opacity:0"></span>
        <div class="item-main">
          <div class="item-title editable" contenteditable="true" data-edit-id="mtg3_title">Private Webinar - Ceph - Harborly - Wade Fisher</div>
          <div class="item-meta editable" contenteditable="true" data-edit-id="mtg3_meta">+cchisolm, +srajan</div>
        </div>
        <div class="item-right">
          <button class="mini right-cta editable" contenteditable="true" data-edit-id="mtg3_cta" type="button" data-action="toast" data-message="Notes">4:00 PM</button>
        </div>
      </div>
    </div>
  </div>

  <!-- RIGHT: Tasks (was Action Required) -->
  <div class="panel">
    <h3 style="margin:0 0 10px;font-size:14px;" class="editable" contenteditable="true" data-edit-id="dash_action_h3">Tasks</h3>

    <div class="list">
      <div class="item" role="button" tabindex="0" data-action="toast" data-message="Call Jimmy">
        <span class="chk" aria-hidden="true"></span>
        <div class="item-main">
          <div class="item-title editable" contenteditable="true" data-edit-id="task1_title">Ari Stern - Driftline </div>
          <div class="item-meta editable" contenteditable="true" data-edit-id="task1_meta">3 month Post-Deployment Check-in</div>
        </div>
        <div class="item-right">
          <button class="mini right-cta editable" data-cta-type="call" contenteditable="true" data-edit-id="task1_cta" type="button" data-action="toast" data-message="Call Jimmy">CALL</button>
        </div>
      </div>

  <div class="item">
    <span class="chk"></span>

  <div class="item-main">
       <div class="item-title" contenteditable="true">
       SPS Review – Northbound Labs
     </div>
        <div class="item-meta" contenteditable="true">
        Weekly compliance check
      </div>
  </div>

  <div class="item-right">
    <button
      class="mini right-cta"
      data-cta-type="sps"
      contenteditable="true">
      REVIEW
    </button>
  </div>
</div>

      <div class="item" role="button" tabindex="0" data-action="toast" data-message="Email recap to Alex">
        <span class="chk" aria-hidden="true"></span>
        <div class="item-main">
          <div class="item-title editable" contenteditable="true" data-edit-id="task2_title">Logan Sound - Port & Main</div>
          <div class="item-meta editable" contenteditable="true" data-edit-id="task2_meta">Confirm Cluster Expansion Details</div>
        </div>
        <div class="item-right">
          <button class="mini right-cta editable" data-cta-type="email" contenteditable="true" data-edit-id="task2_cta" type="button" data-action="toast" data-message="Email Alex">EMAIL</button>
        </div>
      </div>

      <div class="item" role="button" tabindex="0" data-action="toast" data-message="Open configurator">
        <span class="chk" aria-hidden="true"></span>
        <div class="item-main">
          <div class="item-title editable" contenteditable="true" data-edit-id="task3_title">Cal Harbor - Fairwind Systems</div>
          <div class="item-meta editable" contenteditable="true" data-edit-id="task3_meta">Prepare revised Quote with 30TB drives</div>
        </div>
        <div class="item-right">
          <button class="mini right-cta editable" data-cta-type="quote" contenteditable="true" data-edit-id="task3_cta" type="button" data-action="toast" data-message="Configurator">QUOTE</button>
        </div>
      </div>
    </div>
  </div>
</div>
 
          <div class="panel" style="margin-top:14px;">
            <h3 style="margin:0 0 10px;font-size:14px;" class="editable" contenteditable="true" data-edit-id="dash_kpi_h3">How Am I Doing</h3>
            <span class="pill" style="float:right; margin-top:-28px;">KPIs vs Targets</span>

            <div class="kpi-grid">
              <div class="kpi">
                <div class="k editable" contenteditable="true" data-edit-id="kpi1_label">CALLS</div>
                <div class="v editable" contenteditable="true" data-edit-id="kpi1_value">8 / 15 goal</div>
                <div class="bar"><span style="width:53%"></span></div>
                <div style="font-size:12px;color:var(--muted);">On pace: moderate</div>
              </div>
              <div class="kpi">
                <div class="k editable" contenteditable="true" data-edit-id="kpi2_label">MEETINGS</div>
                <div class="v editable" contenteditable="true" data-edit-id="kpi2_value">2 / 3 goal</div>
                <div class="bar"><span style="width:66%"></span></div>
                <div style="font-size:12px;color:var(--muted);">On pace: good</div>              </div>
              <div class="kpi">
                <div class="k editable" contenteditable="true" data-edit-id="kpi3_label">PIPELINE ADDED</div>
                <div class="v editable" contenteditable="true" data-edit-id="kpi3_value">$25K / $60K goal</div>
                <div class="bar"><span style="width:42%"></span></div>
                <div style="font-size:12px;color:var(--muted);">Needs attention</div>
              </div>
              <div class="kpi">
                <div class="k editable" contenteditable="true" data-edit-id="kpi4_label">SPS / COMPLIANCE</div>
                <div class="v editable" contenteditable="true" data-edit-id="kpi4_value">78% weekly</div>
                <div class="bar"><span style="width:78%"></span></div>
                <div style="font-size:12px;color:var(--muted);">Trending up</div>
              </div>
            </div>
          </div>

          <div class="grid" style="margin-top:14px;">
            <div class="panel">
              <h3 style="margin:0 0 10px;font-size:14px;" class="editable" contenteditable="true" data-edit-id="dash_pipeline_h3">Pipeline at a Glance</h3>
              <div class="row" style="flex-direction:column;gap:6px;">
                <div class="editable" contenteditable="true" data-edit-id="pipe_total">Total Pipeline: $485K</div>
                <div class="editable" contenteditable="true" data-edit-id="pipe_forecast">Forecast (Month): $95K</div>
                <div class="editable" contenteditable="true" data-edit-id="pipe_closing">Closing Next 30 Days: 3 Opportunities</div>
              </div>
            </div>

            <div class="panel">
              <h3 style="margin:0 0 10px;font-size:14px;" class="editable" contenteditable="true" data-edit-id="dash_focus_h3">Where to Focus</h3>
              <div class="row" style="flex-direction:column;gap:6px;">
                <button class="btn editable" contenteditable="true" data-edit-id="focus1" data-action="toast" data-message="View stale accounts">Stale Accounts: 6</button>
                <button class="btn editable" contenteditable="true" data-edit-id="focus2" data-action="toast" data-message="Open action required">Accounts with Action Required: 9</button>
                <button class="btn editable" contenteditable="true" data-edit-id="focus3" data-action="toast" data-message="Review risks">At Risk: 3</button>
              </div>
            </div>
          </div>
        
        </div>
        </section>

        <section class="screen hidden" id="accounts" data-pill="S2">
          <div class="accounts-header">
            <div>
              <h2 class="editable" contenteditable="true" data-edit-id="accounts_h2">Accounts Overview</h2>
            <!-- secondary nav from screenshot -- unnecessary but these are also the only buttons 
            we need to work on now * -pipeline
            <div class="accounts-mini-nav">
              <div class="seg" aria-label="Accounts mini navigation">
                <button class="seg-btn" type="button" data-go="dashboard">Dashboard</button>
                <button class="seg-btn" type="button" aria-current="page">Accounts</button>
                <button class="seg-btn" type="button" data-go="pipeline">Pipeline</button>
              </div>
            </div>
          </div>-->

          <div class="accounts-card">
            <div class="accounts-toolbar">
              <div class="label editable" contenteditable="true" data-edit-id="acct_list_label">My Accounts </div>

              <div class="accounts-tabs" role="tablist" aria-label="Account list tabs">
                <button class="pilltab" type="button" data-acct-tab="action">Action Required</button>
                <button class="pilltab" type="button" data-go="sps-master">SPS Tasks</button>
               <!-- <button class="pilltab" type="button" data-acct-tab="open">Open Opportunities</button>
                <button class="pilltab" type="button" data-acct-tab="stale">Stale</button>-->
              </div>

              <div class="accounts-toolbar-right">
                <input class="search" id="acctSearch" type="search" placeholder="Search accounts..." aria-label="Search accounts" />
                <button class="btn dark" type="button" data-action="toast" data-message="New account">New</button>
                <button class="btn" type="button" data-action="toast" data-message="Filter panel">Filter</button>
              </div>
            </div>

            <div class="table" id="acctTable">
              <div class="thead">
                <div>Account Name</div>
                <div class="hide-sm">Industry</div>
                <div>Score</div>
                <div class="hide-sm">Open Opps</div>
                <div class="hide-sm">Pipeline</div>
                <div class="hide-sm">Primary Contact</div>
                <div class="hide-sm">Last Contact</div>
                <div class="hide-sm">Last Activity</div>
                <div></div>
              </div> <!-- end of #acctTable -->

<!-- SPS TASKS (Overview Tab List) -->
<div class="table hidden" id="spsTasksTable">
  <div class="thead" style="grid-template-columns: 1.0fr 1.4fr 1.6fr 1.0fr 1.0fr 1.2fr;">
    <div>Call</div>
    <div>Contact</div>
    <div>Account</div>
    <div class="editable" contenteditable="true" data-edit-id="sps_col4">Field 4</div>
    <div class="editable" contenteditable="true" data-edit-id="sps_col5">Field 5</div>
    <div class="editable" contenteditable="true" data-edit-id="sps_col6">Field 6</div>
  </div>

  <div class="trow" style="grid-template-columns: 1.0fr 1.4fr 1.6fr 1.0fr 1.0fr 1.2fr;">
    <div class="cell editable" contenteditable="true" data-edit-id="sps_r1_c1">Call</div>
    <div class="cell editable" contenteditable="true" data-edit-id="sps_r1_c2">Marina Wells</div>
    <div class="cell">
      <div class="account-name" style="cursor:pointer;">Northbound Labs</div>
      <div class="muted">AM: Allan</div>
    </div>
    <div class="cell editable" contenteditable="true" data-edit-id="sps_r1_c4"></div>
    <div class="cell editable" contenteditable="true" data-edit-id="sps_r1_c5"></div>
    <div class="cell editable" contenteditable="true" data-edit-id="sps_r1_c6"></div>
  </div>

  <div class="trow" style="grid-template-columns: 1.0fr 1.4fr 1.6fr 1.0fr 1.0fr 1.2fr;">
    <div class="cell editable" contenteditable="true" data-edit-id="sps_r2_c1">Email</div>
    <div class="cell editable" contenteditable="true" data-edit-id="sps_r2_c2">Deckard Hull</div>
    <div class="cell">
      <div class="account-name" style="cursor:pointer;">Mooring Digital</div>
      <div class="muted">AM: Allan</div>
    </div>
    <div class="cell editable" contenteditable="true" data-edit-id="sps_r2_c4"></div>
    <div class="cell editable" contenteditable="true" data-edit-id="sps_r2_c5"></div>
    <div class="cell editable" contenteditable="true" data-edit-id="sps_r2_c6"></div>
  </div>
</div>




              <!-- Row 1 -->
              <div class="trow" data-acct-status="my action open" data-acct-name="Town of Leland" data-acct-industry="Government" data-acct-contact="Marina Wells">
                <div class="cell">
                  <div class="account-name editable" contenteditable="true" data-edit-id="acct1_name" data-action="toast" data-message="Open account: Town of Leland">Northbound Labs</div>
                  <div class="account-meta editable" contenteditable="true" data-edit-id="acct1_meta">AM: Allan</div>
                </div>
                <div class="cell hide-sm editable" contenteditable="true" data-edit-id="acct1_industry"><strong>Engineering</strong></div>
                <div class="cell"><span class="score-chip good editable" contenteditable="true" data-edit-id="acct1_score">82</span></div>
                <div class="cell hide-sm editable" contenteditable="true" data-edit-id="acct1_opps">2</div>
                <div class="cell hide-sm editable" contenteditable="true" data-edit-id="acct1_pipe">$165,000</div>
                <div class="cell hide-sm">
                  <div class="stack">
                    <div class="editable" contenteditable="true" data-edit-id="acct1_contact"><strong>Marina Wells</strong></div>
                    <div class="muted editable" contenteditable="true" data-edit-id="acct1_role">IT Director</div>
                  </div>
                </div>
                <div class="cell hide-sm">
                  <div class="stack">
                    <div class="editable" contenteditable="true" data-edit-id="acct1_last">Jan 08</div>
                    <div class="muted editable" contenteditable="true" data-edit-id="acct1_last_type">Call</div>
                  </div>
                </div>
                <div class="cell hide-sm">
                  <div class="stack">
                    <div class="editable" contenteditable="true" data-edit-id="acct1_activity"><strong>Meeting</strong></div>
                    <div class="muted editable" contenteditable="true" data-edit-id="acct1_activity_sub">Discovery</div>
                  </div>
                </div>
                <div class="ar-pill editable" contenteditable="true" data-edit-id="acct1_ar">AR: 3</div>
              </div>

              <!-- Row 2 -->
              <div class="trow" data-acct-status="my action open" data-acct-name="City of Lenoir" data-acct-industry="Government" data-acct-contact="Ben — IT">
                <div class="cell">
                  <div class="account-name editable" contenteditable="true" data-edit-id="acct2_name" data-action="toast" data-message="Open account: City of Lenoir">Wakefield Tech</div>
                  <div class="account-meta editable" contenteditable="true" data-edit-id="acct2_meta">AM: Allan</div>
                </div>
                <div class="cell hide-sm editable" contenteditable="true" data-edit-id="acct2_industry"><strong>Government</strong></div>
                <div class="cell"><span class="score-chip warn editable" contenteditable="true" data-edit-id="acct2_score">74</span></div>
                <div class="cell hide-sm editable" contenteditable="true" data-edit-id="acct2_opps">1</div>
                <div class="cell hide-sm editable" contenteditable="true" data-edit-id="acct2_pipe">$140,000</div>
                <div class="cell hide-sm">
                  <div class="stack">
                    <div class="editable" contenteditable="true" data-edit-id="acct2_contact"><strong>Sandy Banks</strong></div>
                    <div class="muted editable" contenteditable="true" data-edit-id="acct2_role">Systems Administrator</div>
                  </div>
                </div>
                <div class="cell hide-sm">
                  <div class="stack">
                    <div class="editable" contenteditable="true" data-edit-id="acct2_last">Jan 03</div>
                    <div class="muted editable" contenteditable="true" data-edit-id="acct2_last_type">Email</div>
                  </div>
                </div>
                <div class="cell hide-sm">
                  <div class="stack">
                    <div class="editable" contenteditable="true" data-edit-id="acct2_activity"><strong>Quote</strong></div>
                    <div class="muted editable" contenteditable="true" data-edit-id="acct2_activity_sub">Emailed 20261283-4</div>
                  </div>
                </div>
                <div class="ar-pill editable" contenteditable="true" data-edit-id="acct2_ar">AR: 1</div>
              </div>

              <!-- Row 3 -->
              <div class="trow" data-acct-status="my open" data-acct-name="Sunklink" data-acct-industry="Technology" data-acct-contact="Chris Harper">
                <div class="cell">
                  <div class="account-name editable" contenteditable="true" data-edit-id="acct3_name" data-action="toast" data-message="Open account: Sunklink">Anchorpoint Systems</div>
                  <div class="account-meta editable" contenteditable="true" data-edit-id="acct3_meta">AM: Allan</div>
                </div>
                <div class="cell hide-sm editable" contenteditable="true" data-edit-id="acct3_industry"><strong>Aerospace</strong></div>
                <div class="cell"><span class="score-chip good editable" contenteditable="true" data-edit-id="acct3_score">88</span></div>
                <div class="cell hide-sm editable" contenteditable="true" data-edit-id="acct3_opps">1</div>
                <div class="cell hide-sm editable" contenteditable="true" data-edit-id="acct3_pipe">$100,000</div>
                <div class="cell hide-sm">
                  <div class="stack">
                    <div class="editable" contenteditable="true" data-edit-id="acct3_contact"><strong>Deckard Hull</strong></div>
                    <div class="muted editable" contenteditable="true" data-edit-id="acct3_role">Technical Lead</div>
                  </div>
                </div>
                <div class="cell hide-sm">
                  <div class="stack">
                    <div class="editable" contenteditable="true" data-edit-id="acct3_last">Dec 28</div>
                    <div class="muted editable" contenteditable="true" data-edit-id="acct3_last_type">Call</div>
                  </div>
                </div>
                <div class="cell hide-sm">
                  <div class="stack">
                    <div class="editable" contenteditable="true" data-edit-id="acct3_activity"><strong>Follow-up</strong></div>
                    <div class="muted editable" contenteditable="true" data-edit-id="acct3_activity_sub">Scheduled</div>
                  </div>
                </div>
                <div class="ar-pill editable" contenteditable="true" data-edit-id="acct3_ar">AR: 0</div>
              </div>

              <!-- Row 4 -->
              <div class="trow" data-acct-status="action open stale" data-acct-name="IMP Solutions (HRM)" data-acct-industry="Partner / Gov" data-acct-contact="IMP Team">
                <div class="cell">
                  <div class="account-name editable" contenteditable="true" data-edit-id="acct4_name" data-action="toast" data-message="Open account: IMP Solutions (HRM)">Mooring Digital</div>
                  <div class="account-meta editable" contenteditable="true" data-edit-id="acct4_meta">AM: Allan</div>
                </div>
                <div class="cell hide-sm editable" contenteditable="true" data-edit-id="acct4_industry"><strong>Manufacturing</strong></div>
                <div class="cell"><span class="score-chip bad editable" contenteditable="true" data-edit-id="acct4_score">61</span></div>
                <div class="cell hide-sm editable" contenteditable="true" data-edit-id="acct4_opps">2</div>
                <div class="cell hide-sm editable" contenteditable="true" data-edit-id="acct4_pipe">$220,000</div>
                <div class="cell hide-sm">
                  <div class="stack">
                    <div class="editable" contenteditable="true" data-edit-id="acct4_contact"><strong>Cole Current</strong></div>
                    <div class="muted editable" contenteditable="true" data-edit-id="acct4_role">Creative Director</div>
                  </div>
                </div>
                <div class="cell hide-sm">
                  <div class="stack">
                    <div class="editable" contenteditable="true" data-edit-id="acct4_last">Dec 15</div>
                    <div class="muted editable" contenteditable="true" data-edit-id="acct4_last_type">Call</div>
                  </div>
                </div>
                <div class="cell hide-sm">
                  <div class="stack">
                    <div class="editable" contenteditable="true" data-edit-id="acct4_activity"><strong>Stale</strong></div>
                    <div class="muted editable" contenteditable="true" data-edit-id="acct4_activity_sub">No activity completed in 24d</div>
                  </div>
                </div>
                <div class="ar-pill editable" contenteditable="true" data-edit-id="acct4_ar">AR: 4</div>
              </div>
            </div>

            <div class="table-footer">
              <div class="editable" contenteditable="true" data-edit-id="acct_pagination_left">1–4 of 24</div>
              <div class="pager">
                <a data-action="toast" data-message="Previous page">Previous</a>
                <a data-action="toast" data-message="Next page">Next</a>
              </div>
            </div>
          </div>
        </section>




        <!-- ACCOUNT DETAIL (this is the indivual detailed screen for each account) -->
        <section class="screen hidden" id="account-detail" data-pill="Acct">
          <!-- Header -->
          <div class="acctd-head">
            <div>
              <h2 id="acctdName" class="editable" contenteditable="true" data-edit-id="acctd_name">Town of Leland</h2>
              <div class="acctd-sub editable" contenteditable="true" data-edit-id="acctd_sub">
                AM: Allan Hillier AE:
              </div>
            </div>

        <button class="acctd-back" type="button" data-go="accounts">
          ← Accounts overview
        </button>

          </div>

          <!-- 3-column grid -->
          <div class="acctd-grid">
            <!-- LEFT COLUMN -->
            <div class="acctd-col">
              <div class="panel">
                <div class="panel-title">ACCOUNT SUMMARY</div>
                <div class="kv">
                  <div class="k">Account:</div>
                  <div class="v editable" id="acctdSumAccount" contenteditable="true" data-edit-id="acctd_sum_account">Town of Leland</div>

                  <div class="k">AM:</div>
                  <div class="v editable" id="acctdSumAM" contenteditable="true" data-edit-id="acctd_sum_AM">Allan Hillier</div>

                  <div class="k">Sub Accounts:</div>
                  <div class="v editable" contenteditable="true" data-edit-id="acctd_sum_sub">3</div>

                  <div class="k">Opportunities:</div>
                  <div class="v editable" contenteditable="true" data-edit-id="acctd_sum_opps">2 open</div>

                  <div class="k">Inquiries:</div>
                  <div class="v editable" contenteditable="true" data-edit-id="acctd_sum_inq">7</div>
                </div>

                <div class="panel-link editable" contenteditable="true" data-edit-id="acctd_org_link">View Org Chart</div>
              </div>

              <div class="panel">
                <div class="panel-title">SUB ACCOUNTS</div>
                <ul class="bullets editable" contenteditable="true" data-edit-id="acctd_subaccounts">
                  <li>IT Department</li>
                  <li>Finance Department</li>
                  <li>Research Lab</li>
                </ul>
              </div>

              <div class="panel">
                <div class="panel-title">OPPORTUNITIES</div>

                <div class="opp">
                  <div class="opp-name editable" contenteditable="true" data-edit-id="acctd_opp1_name">NAS Refresh - 480TB</div>
                  <div class="opp-meta editable" contenteditable="true" data-edit-id="acctd_opp1_meta">Stage: Discovery • Value: $120,000</div>
                </div>

                <div class="opp">
                  <div class="opp-name editable" contenteditable="true" data-edit-id="acctd_opp2_name">Backup Expansion</div>
                  <div class="opp-meta editable" contenteditable="true" data-edit-id="acctd_opp2_meta">Stage: Quote • Value: $45,000</div>
                </div>

                <div class="panel-link editable" contenteditable="true" data-edit-id="acctd_view_all_opps">View all opportunities</div>
              </div>
            </div>

            <!-- CENTER COLUMN -->
            <div class="acctd-col">
              <div class="panel">
                <div class="panel-title">SALES ENGINE</div>

                <div class="row" style="justify-content:space-between;align-items:center;margin-bottom:10px;">
                  <div class="mini-label">ACTIVITIES</div>
                  <div class="acctd-actions">
                    <!--Commenting out for new fields Roger suggested on Feb 3rd ----- <button class="mini dark" type="button" data-action="toast" data-message="Place Call">Place Call</button>
                    <button class="mini" type="button" data-action="toast" data-message="Schedule Meeting">Schedule Meeting</button>
                    <button class="mini" type="button" data-action="toast" data-message="Create Task">Create Task</button>
                    <button class="mini" type="button" data-action="toast" data-message="Log Note">Log Note</button>-->
        <button class="mini dark" type="button" data-open-activity="call">Schedule Call</button>
        <button class="mini" type="button" data-open-activity="meeting">Schedule Meeting</button>
        <button class="mini" type="button" data-open-activity="task">Create Task</button>












                  </div>
                </div>

                <div class="mini-label" style="margin:12px 0 8px;">ACTION REQUIRED</div>

                <div class="arlist">
                  <div class="aritem">
                    <span class="chk" aria-hidden="true"></span>
                    <div class="ar-main">
                      <div class="ar-title editable" contenteditable="true" data-edit-id="acctd_ar1_title">Send recap email to Alex</div>
                      <div class="ar-meta editable" contenteditable="true" data-edit-id="acctd_ar1_meta">Triggered by: Meeting completed • Due: Today</div>
                    </div>
                    <span class="tag hot editable" contenteditable="true" data-edit-id="acctd_ar1_tag">HOT</span>
                  </div>

                  <div class="aritem">
                    <span class="chk" aria-hidden="true"></span>
                    <div class="ar-main">
                      <div class="ar-title editable" contenteditable="true" data-edit-id="acctd_ar2_title">Update opportunity stage: Discovery → Quote</div>
                      <div class="ar-meta editable" contenteditable="true" data-edit-id="acctd_ar2_meta">Triggered by: Quote requested • Due: Tomorrow</div>
                    </div>
                    <span class="tag warm editable" contenteditable="true" data-edit-id="acctd_ar2_tag">WARM</span>
                  </div>

                  <div class="aritem">
                    <span class="chk" aria-hidden="true"></span>
                    <div class="ar-main">
                      <div class="ar-title editable" contenteditable="true" data-edit-id="acctd_ar3_title">Follow up on quote for Jimmy</div>
                      <div class="ar-meta editable" contenteditable="true" data-edit-id="acctd_ar3_meta">Triggered by: Quote sent • Due: 3 days</div>
                    </div>
                    <span class="tag cool editable" contenteditable="true" data-edit-id="acctd_ar3_tag">COOL</span>
                  </div>
                </div>

                <div class="mini-label" style="margin:14px 0 8px;">ALL ACTIVITY</div>
                <ul class="bullets editable" contenteditable="true" data-edit-id="acctd_all_activity">
                  <li>Call Joe</li>
                  <li>Meeting with Alex @ 2:00 PM</li>
                  <li>Follow up on quote for Jimmy</li>
                </ul>
              </div>

              <div class="panel">
                <div class="panel-title">SPS</div>

                <div class="acctd-tabs">
                  <button class="tab active" type="button" data-sps="positioning">Positioning</button>
                  <button class="tab" type="button" data-sps="discovery">Discovery</button>
                  <button class="tab" type="button" data-sps="quote">Quote</button>
                  <button class="tab" type="button" data-sps="po">PO</button>
                  <button class="tab" type="button" data-sps="post">Post Close</button>
                </div>

                <div class="acctd-spsbox">
                  <div class="editable" contenteditable="true" data-edit-id="acctd_sps_copy">
                    SPS content placeholder<br/>
                    — prompts + structured steps per stage
                  </div>
                </div>

                <div class="panel-link editable" contenteditable="true" data-edit-id="acctd_create_sps">Create SPS activity</div>
              </div>
            </div>

            <!-- RIGHT COLUMN -->
            <div class="acctd-col">
              <div class="panel">
                <div class="panel-title">HEALTH</div>
                <div class="kv">
                  <div class="k">Score:</div>
                  <div class="v editable" id="acctdHealthScore" contenteditable="true" data-edit-id="acctd_health_score">82</div>

                  <div class="k">Contacts:</div>
                  <div class="v editable" contenteditable="true" data-edit-id="acctd_health_contacts">14</div>

                  <div class="k">Champions:</div>
                  <div class="v editable" contenteditable="true" data-edit-id="acctd_health_champions">2</div>

                  <div class="k">Blockers:</div>
                  <div class="v editable" contenteditable="true" data-edit-id="acctd_health_blockers">1</div>
                </div>
              </div>

              <div class="panel">
                <div class="panel-title">HISTORY</div>
                <div class="kv">
                  <div class="k">Last Purchase:</div>
                  <div class="v editable" contenteditable="true" data-edit-id="acctd_hist_item">HVMC Cluster</div>

                  <div class="k">Date:</div>
                  <div class="v editable" contenteditable="true" data-edit-id="acctd_hist_date">2025-11-12</div>
                </div>
              </div>

              <div class="panel">
                <div class="panel-title">QUALITY</div>
                <div class="kv">
                  <div class="k">Radar:</div>
                  <div class="v editable" contenteditable="true" data-edit-id="acctd_qual_radar">Open</div>

                  <div class="k">Tickets:</div>
                  <div class="v editable" contenteditable="true" data-edit-id="acctd_qual_tickets">3 (View)</div>

                  <div class="k">NCRs:</div>
                  <div class="v editable" contenteditable="true" data-edit-id="acctd_qual_ncrs">0</div>
                </div>
              </div>

              <div class="panel">
                <div class="panel-title">PRODUCTS / SERVICES</div>
                <div class="kv">
                  <div class="k">Products:</div>
                  <div class="v editable" contenteditable="true" data-edit-id="acctd_prod_products">View</div>

                  <div class="k">Services:</div>
                  <div class="v editable" contenteditable="true" data-edit-id="acctd_prod_services">View</div>
                </div>
              </div>

              <div class="panel">
                <div class="panel-title">ACCOUNTING</div>
                <div class="kv">
                  <div class="k">Credit:</div>
                  <div class="v editable" contenteditable="true" data-edit-id="acctd_acct_credit">Good</div>

                  <div class="k">Terms:</div>
                  <div class="v editable" contenteditable="true" data-edit-id="acctd_acct_terms">Net 30</div>
                </div>
              </div>
            </div>
          </div>
        </section>


                <!-- LEADS -->
        

        <section class="screen hidden" id="leads" data-pill="S3">
                  <h2 class="editable" contenteditable="true" data-edit-id="leads_h2">Leads</h2>
                  <p class="editable" contenteditable="true" data-edit-id="leads_p">Inbound + outbound leads, triage, and nurture queues.</p>

                  <div class="grid">
                    <div class="panel">
                      <h3 style="margin:0 0 10px;font-size:14px;" class="editable" contenteditable="true" data-edit-id="leads_inbox_h3">Lead Inbox</h3>
                      <div class="hint" data-notes><strong>Notes:</strong> New leads that need first touch. Add SLA / age.</div>
                      <div class="row" style="flex-direction:column;gap:8px;">
                        <button class="btn" data-action="toast" data-message="Open lead">New lead — needs qualification</button>
                        <button class="btn" data-action="toast" data-message="Open lead">Web form — pricing question</button>
                      </div>
                    </div>
                    <div class="panel">
                      <h3 style="margin:0 0 10px;font-size:14px;" class="editable" contenteditable="true" data-edit-id="leads_nurture_h3">Nurture</h3>
                      <div class="hint" data-notes><strong>Notes:</strong> Follow-ups and drip sequences. Add next-touch dates.</div>
                      <div class="row" style="flex-direction:column;gap:8px;">
                        <button class="btn" data-action="toast" data-message="Nurture">Nurture list (placeholder)</button>
                      </div>
                    </div>
                  </div>
                </section>


<!-- Master SPS List overview -->
<section class="screen hidden" id="sps-master">
  <div class="accounts-header">
    <h2>SPS Tasks</h2>
    <p class="muted">All SPS follow-ups across all accounts</p>

    <button class="btn" type="button" data-go="accounts">
      ← Back to Accounts
    </button>
  </div>

  <div class="accounts-card">
    <div class="list">
      <div class="item">
        <span class="chk" aria-hidden="true"></span>
        <div class="item-main">
          <div class="item-title">
            <strong>Northbound Labs</strong> — Send recap email
          </div>
          <div class="item-meta">
            Due today • SPS: Discovery
          </div>
        </div>
      </div>
    </div>
  </div>
</section>


                <!-- PIPELINE -->

        <section class="screen hidden" id="pipeline" data-pill="S4">
          <h2 class="editable" contenteditable="true" data-edit-id="pipe_h2">Pipeline</h2>
          <p class="editable" contenteditable="true" data-edit-id="pipe_p">Deals by stage, forecast, and next steps.</p>


          <!-- optional mini nav (mirrors accounts) 
          <div class="accounts-mini-nav" style="margin-top:12px;">
            <div class="seg" aria-label="Pipeline mini navigation">
              <button class="seg-btn" type="button" data-go="dashboard">Dashboard</button>
              <button class="seg-btn" type="button" data-go="accounts">Accounts</button>
              <button class="seg-btn" type="button" aria-current="page">Pipeline</button>
            </div>
          </div>-->

          <!-- PIPELINE LIST -->
          <div class="accounts-card" style="margin-top:12px;">
            <div class="accounts-toolbar">
              <div class="label editable" contenteditable="true" data-edit-id="pipe_list_label">My Opportunities</div>

              <div class="accounts-tabs" role="tablist" aria-label="Pipeline list tabs">
                <button class="pilltab" type="button" data-pipe-tab="all" aria-current="page">All</button>
                <button class="pilltab" type="button" data-pipe-tab="closing">Closing Soon</button>
                <button class="pilltab" type="button" data-pipe-tab="risk">At Risk</button>
                <button class="pilltab" type="button" data-pipe-tab="stale">Stale</button>
              </div>

              <div class="accounts-toolbar-right">
                <input class="search" id="pipeSearch" type="search" placeholder="Search deals or accounts..." aria-label="Search pipeline" />
                <button class="btn" type="button" id="pipeToggleGroup">Group: Stage</button>
                <button class="btn primary" type="button" data-action="toast" data-message="New opportunity (prototype)">+ New Opportunity</button>
              </div>
            </div>

            <div class="table" id="pipeTable"></div>

            <div class="table-footer">
              <div class="editable" contenteditable="true" data-edit-id="pipe_pagination_left">Showing demo Opportunities</div>
              <div class="pager">
                <a data-action="toast" data-message="Previous page">Previous</a>
                <a data-action="toast" data-message="Next page">Next</a>
              </div>
            </div>
          </div>
        </section>

        <section class="screen hidden" id="reporting" data-pill="S5">
                  <h2 class="editable" contenteditable="true" data-edit-id="report_h2">Reporting</h2>
                  <p class="editable" contenteditable="true" data-edit-id="report_p">Performance, activity, and pipeline analytics.</p>

                  <div class="grid">
                    <div class="panel">
                      <h3 style="margin:0 0 10px;font-size:14px;" class="editable" contenteditable="true" data-edit-id="report_kpi_h3">KPIs</h3>
                      <div class="hint" data-notes><strong>Notes:</strong> KPI cards + date ranges live here.</div>
                      <button class="btn" data-action="toast" data-message="Change date range">Date Range</button>
                    </div>
                    <div class="panel">
                      <h3 style="margin:0 0 10px;font-size:14px;" class="editable" contenteditable="true" data-edit-id="report_team_h3">Team View</h3>
                      <div class="hint" data-notes><strong>Notes:</strong> Filters by rep/region, rollups for management.</div>
                      <button class="btn" data-action="toast" data-message="View team report">Open Team Report</button>
                    </div>
                  </div>
                </section>

                <!-- ADMIN -->
        

        <section class="screen hidden" id="admin" data-pill="S6">
                  <h2 class="editable" contenteditable="true" data-edit-id="admin_h2">Admin</h2>
                  <p class="editable" contenteditable="true" data-edit-id="admin_p">Management / configuration area (permissions, routing, templates).</p>

                  <div class="panel">
                    <h3 style="margin:0 0 10px;font-size:14px;" class="editable" contenteditable="true" data-edit-id="admin_tools_h3">Admin Tools</h3>
                    <div class="row">
                      <button class="btn" data-action="toast" data-message="User management">Users & Roles</button>
                      <button class="btn" data-action="toast" data-message="Templates">Templates</button>
                      <button class="btn" data-action="toast" data-message="Routing">Lead Routing</button>
                    </div>
                    <div class="hint" data-notes><strong>Notes:</strong> Keep this limited for management only.</div>
                  </div>
                </section>

                <!-- SETTINGS -->
        

        <section class="screen hidden" id="settings" data-pill="S7">
                  <h2 class="editable" contenteditable="true" data-edit-id="settings_h2">Settings</h2>
                  <p class="editable" contenteditable="true" data-edit-id="settings_p">Preferences screen (placeholder).</p>

                  <div class="grid">
                    <div class="panel">
                      <h3 style="margin: 0 0 10px; font-size: 14px;" class="editable" contenteditable="true" data-edit-id="settings_pref_h3">Preferences</h3>
                      <div class="row">
                        <button class="btn" data-action="toast" data-message="Toggled Dark Mode (placeholder)" type="button">Toggle Dark Mode</button>
                        <button class="btn" data-action="toast" data-message="Changed Notifications (placeholder)" type="button">Notifications</button>
                      </div>
                      <div class="row" style="margin-top: 10px;">
                        <button class="btn primary" data-go="dashboard" type="button">Save → Dashboard</button>
                        <button class="btn" data-go="dashboard" type="button">Cancel → Dashboard</button>
                      </div>
                    </div>

                    <div class="panel">
                      <h3 style="margin: 0 0 10px; font-size: 14px;" class="editable" contenteditable="true" data-edit-id="settings_about_h3">About</h3>
                      <p class="editable" contenteditable="true" data-edit-id="settings_about_p" style="margin: 0; color: var(--muted); font-size: 13px; line-height: 1.5;">
                      </p>
                    </div>
                  </div>
                </section>
      </div>

      </div>
    </section>
  </main>


<!-- ========= ACTIVITIES MODALS (wireframe) ========= -->
<div class="modal-overlay" id="activityModal">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="activityModalTitle">
    <div class="modal-head">
      <div class="modal-title" id="activityModalTitle">Schedule Call</div>
      <button class="modal-close" type="button" data-modal-close>✕</button>
    </div>

    <div class="modal-body">
      <div class="modal-row">
        <label>Account (auto)</label>
        <input id="actAccount" type="text" value="Town of Leland" />
      </div>

      <div class="modal-row">
        <label>Owner (auto)</label>
        <input id="actOwner" type="text" value="Allan" />
      </div>

      <div class="modal-row">
        <label>Reason</label>
        <select id="actReason"></select>
      </div>

      <!-- CALL: when chips -->
      <div class="modal-row" id="callWhenRow">
        <label>When</label>
        <div class="chipset" id="callWhenChips">
          <button class="chip" type="button" data-when="Now" aria-pressed="true">Now</button>
          <button class="chip" type="button" data-when="Later today" aria-pressed="false">Later today</button>
          <button class="chip" type="button" data-when="Tomorrow" aria-pressed="false">Tomorrow</button>
          <button class="chip" type="button" data-when="Pick a time" aria-pressed="false">Pick a time</button>
        </div>
      </div>

      <!-- MEETING: datetime -->
      <div class="modal-row hidden" id="meetingDateRow">
        <label>Date & time</label>
        <input id="meetingDate" type="text" value="Apr 24, 2024 • 2:00 PM • 60 min" />
      </div>

      <!-- TASK: due chips -->
      <div class="modal-row hidden" id="taskDueRow">
        <label>Due date</label>
        <div class="chipset" id="taskDueChips">
          <button class="chip" type="button" data-due="Today" aria-pressed="true">Today</button>
          <button class="chip" type="button" data-due="Tomorrow" aria-pressed="false">Tomorrow</button>
          <button class="chip" type="button" data-due="This week" aria-pressed="false">This week</button>
          <button class="chip" type="button" data-due="Pick a date" aria-pressed="false">Pick a date</button>
        </div>
      </div>

      <div class="modal-row">
        <label>Title (auto format, editable)</label>
        <input id="actTitle" type="text" value="Call – Follow-up / Next Step" />
      </div>
    </div>

    <div class="modal-actions">
      <button class="btn" type="button" data-modal-close>Cancel</button>
      <button class="btn primary" type="button" id="actPrimaryBtn">Save</button>
    </div>
  </div>
</div>

<div class="modal-overlay" id="outcomeModal">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="outcomeModalTitle">
    <div class="modal-head">
      <div class="modal-title" id="outcomeModalTitle">Mark Done</div>
      <button class="modal-close" type="button" data-outcome-close>✕</button>
    </div>
    <div class="modal-body">
      <div class="modal-row">
        <label>Outcome</label>
        <select id="outcomeSelect"></select>
      </div>
    </div>
    <div class="modal-actions">
      <button class="btn" type="button" data-outcome-close>Cancel</button>
      <button class="btn primary" type="button" id="outcomeSaveBtn">Save</button>
    </div>
  </div>
</div>

  <div class="toast" id="toast" role="status" aria-live="polite"></div>

  

<script>
    // --- Simple navigation + history for clickable wireframes ---
const screensEl = document.getElementById('screens');
const navEl = document.getElementById('nav');
const toastEl = document.getElementById('toast');
const historyStack = [];
let currentScreenId = 'dashboard';

    function showToast(message) {
      toastEl.textContent = message;
      toastEl.classList.add('show');
      window.clearTimeout(showToast._t);
      showToast._t = window.setTimeout(() => toastEl.classList.remove('show'), 1400);
    }

    function setActiveNav(id) {
      // Sidebar nav
      navEl.querySelectorAll('button[data-go]').forEach(btn => {
        const isActive = btn.getAttribute('data-go') === id;
        btn.setAttribute('aria-current', isActive ? 'page' : 'false');
      });

      // Top tabs
      document.querySelectorAll('.top-tabs .tab[data-go]').forEach(tab => {
        const isActive = tab.getAttribute('data-go') === id;
        tab.setAttribute('aria-current', isActive ? 'page' : 'false');
      });
    }


    function openAccountDetailFromRow(row){
  if(!row) return;
  const name = row.querySelector('.account-name')?.innerText?.trim() || 'Account';

  // Fill key spots in the detail header + summary
  const set = (id, val) => { const el = document.getElementById(id); if(el) el.innerText = val; };
  set('acctdName', name);
  set('acctdSumAccount', name);

  // Optional: set owner/region/status if you have them in the row later
  // set('acctdSumOwner', owner);

  showScreen('account-detail');
  showToast(`Opened: ${name}`);
}


/* =========================
   ACTIVITIES: modals + create + outcomes (wireframe)
   ========================= */

const REASONS = [
  "Follow-up / Next Step",
  "Discovery / Qualification",
  "Demo / Walkthrough",
  "Quote / Proposal Review",
  "Re-Engage (stalled / no response)"
];

const OUTCOMES = {
  call: ["Connected", "Voicemail", "No answer", "Rescheduled"],
  meeting: ["Held", "No show", "Rescheduled", "Canceled"]
};

let ACT_STATE = {
  type: "call",
  when: "Now",
  due: "Today",
  activeItemEl: null
};

const activityModal = document.getElementById("activityModal");
const outcomeModal  = document.getElementById("outcomeModal");

const actReason = document.getElementById("actReason");
const actTitle  = document.getElementById("actTitle");
const actPrimaryBtn = document.getElementById("actPrimaryBtn");

const callWhenRow = document.getElementById("callWhenRow");
const meetingDateRow = document.getElementById("meetingDateRow");
const taskDueRow = document.getElementById("taskDueRow");

function fillReasons(){
  if (!actReason) return;
  actReason.innerHTML = REASONS.map(r => `<option value="${r}">${r}</option>`).join("");
  actReason.value = REASONS[0];
}
fillReasons();

function setModalType(type){
  ACT_STATE.type = type;

  // Title + primary CTA copy
  const titleEl = document.getElementById("activityModalTitle");
  if (titleEl) titleEl.textContent =
    type === "call" ? "Schedule Call" :
    type === "meeting" ? "Schedule Meeting" : "Create Task";

  if (actPrimaryBtn) actPrimaryBtn.textContent = (type === "call") ? "Save" : "Save";

  // Show/hide rows
  callWhenRow.classList.toggle("hidden", type !== "call");
  meetingDateRow.classList.toggle("hidden", type !== "meeting");
  taskDueRow.classList.toggle("hidden", type !== "task");

  // Auto title format
  const reason = actReason?.value || REASONS[0];
  if (actTitle) {
    const prefix = type === "call" ? "Call" : type === "meeting" ? "Meeting" : "Task";
    actTitle.value = `${prefix} – ${reason}`;
  }
}

function openModal(type){
  setModalType(type);
  if (activityModal) activityModal.classList.add("open");
}
function closeModal(){
  if (activityModal) activityModal.classList.remove("open");
}

function openOutcomeModal(itemEl){
  ACT_STATE.activeItemEl = itemEl;
  const type = itemEl?.getAttribute("data-activity-type") || "call";

  const outcomeSelect = document.getElementById("outcomeSelect");
  const list = OUTCOMES[type] || [];
  outcomeSelect.innerHTML = list.map(o => `<option value="${o}">${o}</option>`).join("");

  if (outcomeModal) outcomeModal.classList.add("open");
}
function closeOutcomeModal(){
  if (outcomeModal) outcomeModal.classList.remove("open");
}

function pressOneChip(container, pressedBtn){
  container.querySelectorAll(".chip").forEach(b => b.setAttribute("aria-pressed", "false"));
  pressedBtn.setAttribute("aria-pressed", "true");
}

/* Chips wiring */
document.getElementById("callWhenChips")?.addEventListener("click", (e) => {
  const btn = e.target.closest(".chip");
  if (!btn) return;
  ACT_STATE.when = btn.getAttribute("data-when") || "Now";
  pressOneChip(e.currentTarget, btn);
});

document.getElementById("taskDueChips")?.addEventListener("click", (e) => {
  const btn = e.target.closest(".chip");
  if (!btn) return;
  ACT_STATE.due = btn.getAttribute("data-due") || "Today";
  pressOneChip(e.currentTarget, btn);
});

/* Keep title auto-format in sync when reason changes */
actReason?.addEventListener("change", () => setModalType(ACT_STATE.type));

/* Close buttons */
document.addEventListener("click", (e) => {
  if (e.target.matches("[data-modal-close]")) closeModal();
  if (e.target.matches("[data-outcome-close]")) closeOutcomeModal();
});

/* Open modal buttons (dashboard + anywhere else) */
document.addEventListener("click", (e) => {
  const btn = e.target.closest("[data-open-activity]");
  if (!btn) return;
  if (e.target.closest('[contenteditable="true"]')) return;
  openModal(btn.getAttribute("data-open-activity"));
});

/* Save activity → drop into Dashboard lists */
actPrimaryBtn?.addEventListener("click", () => {
  const type = ACT_STATE.type;
  const reason = actReason?.value || REASONS[0];
  const title = actTitle?.value || "";

  // Decide target list (simple wireframe rule)
  const meetingsList = document.querySelector("#dashboard .panel .list"); // first list on dashboard = meetings
  const tasksPanel = document.querySelectorAll("#dashboard .panel")[1];
  const tasksList = tasksPanel?.querySelector(".list");

  const itemHTML = (() => {
    if (type === "meeting") {
      return `
        <div class="item" data-activity-type="meeting">
          <span class="chk" aria-hidden="true" style="opacity:0"></span>
          <div class="item-main">
            <div class="item-title">${title || ("Meeting – " + reason)}</div>
            <div class="item-meta">${reason}</div>
          </div>
          <div class="item-right">
            <button class="mini right-cta" type="button" data-action="toast" data-message="Join">Join</button>
            <button class="mini" type="button" data-mark-done>Mark Done</button>
          </div>
        </div>
      `;
    }

    if (type === "task") {
      return `
        <div class="item" data-activity-type="task">
          <span class="chk" aria-hidden="true"></span>
          <div class="item-main">
            <div class="item-title">${title || ("Task – " + reason)}</div>
            <div class="item-meta">Due: ${ACT_STATE.due} • ${reason}</div>
          </div>
          <div class="item-right">
            <button class="mini" type="button" data-complete-task>Complete</button>
          </div>
        </div>
      `;
    }

    // call
    return `
      <div class="item" data-activity-type="call">
        <span class="chk" aria-hidden="true"></span>
        <div class="item-main">
          <div class="item-title">${title || ("Call – " + reason)}</div>
          <div class="item-meta">When: ${ACT_STATE.when} • ${reason}</div>
        </div>
        <div class="item-right">
          <button class="mini right-cta" data-cta-type="call" type="button" data-action="toast" data-message="Call Now">CALL</button>
          <button class="mini" type="button" data-mark-done>Mark Done</button>
        </div>
      </div>
    `;
  })();

  if (type === "meeting" && meetingsList) meetingsList.insertAdjacentHTML("afterbegin", itemHTML);
  if (type !== "meeting" && tasksList) tasksList.insertAdjacentHTML("afterbegin", itemHTML);

  showToast("Activity saved");
  closeModal();
});

/* Mark Done + Complete */
document.addEventListener("click", (e) => {
  const markBtn = e.target.closest("[data-mark-done]");
  const completeBtn = e.target.closest("[data-complete-task]");
  if (!markBtn && !completeBtn) return;

  const item = e.target.closest(".item");
  const type = item?.getAttribute("data-activity-type");

  if (completeBtn && item) {
    item.remove();
    showToast("Task completed");
    return;
  }

  if (markBtn && item && (type === "call" || type === "meeting")) {
    openOutcomeModal(item);
  }
});

/* Save outcome */
document.getElementById("outcomeSaveBtn")?.addEventListener("click", () => {
  const item = ACT_STATE.activeItemEl;
  const outcome = document.getElementById("outcomeSelect")?.value || "";

  if (item) {
    // wireframe: append outcome to meta and remove row after save
    const meta = item.querySelector(".item-meta");
    if (meta) meta.textContent = `${meta.textContent} • Outcome: ${outcome}`;
    item.remove();
  }

  showToast("Marked done");
  closeOutcomeModal();
});


document.addEventListener('click', (e) => {
  const nameEl = e.target.closest('.account-name');
  if (nameEl) {
    const row = nameEl.closest('.trow');
    openAccountDetailFromRow(row);
    return;
  }
});

    function showScreen(id, { pushHistory = true } = {}) {
      const next = document.getElementById(id);
      if (!next) {
        showToast(`No screen found: ${id}`);
        return;
      }

      if (pushHistory && currentScreenId && currentScreenId !== id) {
        historyStack.push(currentScreenId);
      }

      screensEl.querySelectorAll('.screen').forEach(s => s.classList.add('hidden'));
      next.classList.remove('hidden');

      currentScreenId = id;
      setActiveNav(id);

      window.location.hash = id;
    }

    // Click handler for any element with data-go or data-action
    document.addEventListener('click', (e) => {
      // If the user is editing text, don't trigger navigation/toasts.
      if (e.target.closest('[contenteditable="true"]')) return;

      const goEl = e.target.closest('[data-go]');
      const actEl = e.target.closest('[data-action]');

      if (goEl) {
        const id = goEl.getAttribute('data-go');
        showScreen(id);
        return;
      }

      if (actEl) {
        const action = actEl.getAttribute('data-action');
        if (action === 'toast') {
          const msg = actEl.getAttribute('data-message') || 'Action';
          showToast(msg);
        }
      }
    });


    // --- Inline editing: persist edits in localStorage ---
    const EDIT_STORE_KEY = 'wf_inline_edits_v2';

    function loadEdits() {
      try { return JSON.parse(localStorage.getItem(EDIT_STORE_KEY) || '{}'); } catch (_) { return {}; }
    }

    function saveEdits(map) {
      try { localStorage.setItem(EDIT_STORE_KEY, JSON.stringify(map)); } catch (_) {}
    }

    function initInlineEditing() {
      const edits = loadEdits();
      document.querySelectorAll('[data-edit-id]').forEach(el => {
        const id = el.getAttribute('data-edit-id');

        if (edits[id] != null) {
          el.innerText = edits[id];
        }

        const persist = () => {
          const current = el.innerText;
          const latest = loadEdits();
          latest[id] = current;
          saveEdits(latest);
        };

        el.addEventListener('blur', persist);
        el.addEventListener('input', () => {
          window.clearTimeout(el._t);
          el._t = window.setTimeout(persist, 250);
        });

        el.addEventListener('keydown', (ev) => {
          if (ev.key === 'Enter') {
            ev.preventDefault();
            el.blur();
          }
        });
      });
    }

    // Load theme preference
    try {
      const saved = localStorage.getItem('wf_theme');
      if (saved === 'dark' || saved === 'light') {
        document.documentElement.setAttribute('data-theme', saved);
      }
    } catch (_) {}

    // Basic self-tests (visible in console)
    function runSelfTests() {
      const requiredScreens = ['dashboard', 'accounts', 'leads', 'pipeline', 'reporting', 'admin', 'settings'];
      const missing = requiredScreens.filter(id => !document.getElementById(id));
      console.assert(missing.length === 0, 'Missing screens:', missing);

      // showScreen should not throw
      try {
        showScreen('dashboard', { pushHistory: false });
        showScreen('accounts', { pushHistory: false });
        showScreen('dashboard', { pushHistory: false });
        console.assert(true, 'Navigation smoke test passed');
      } catch (e) {
        console.error('Navigation smoke test failed', e);
        console.assert(false, 'Navigation smoke test failed');
      }
    }

    initInlineEditing();

    // Load from hash on refresh
    const initial = (window.location.hash || '#dashboard').replace('#', '');
    showScreen(initial, { pushHistory: false });
    runSelfTests();



    /* =========================
   PIPELINE: data + rendering
   ========================= */

/**
 * EDIT HERE: demo data model
 * Keep it small + believable.
 * You can later derive this from DOM if you want, but JS-first is cleaner.
 */
const CRM_DATA = {
  accounts: [
    {
      id: "acct_nb",
      name: "Northbound Labs",
      industry: "Engineering",
      am: "Allan",
      score: 82,
      arCount: 3,
      lastTouch: { date: "Jan 08", type: "Call" },
      staleDays: 6,
      opportunities: [
        {
          id: "opp_nb_1",
          name: "NAS Refresh - 480TB",
          stage: "Discovery",
          value: 120000,
          risk: "warm",      // cool | warm | hot
          closingDays: 21,   // use for “Closing Soon”
          lastActivity: "Discovery meeting completed"
        },
        {
          id: "opp_nb_2",
          name: "Backup Expansion",
          stage: "Quote",
          value: 45000,
          risk: "cool",
          closingDays: 35,
          lastActivity: "Quote requested"
        }
      ]
    },

    {
      id: "acct_wf",
      name: "Wakefield Tech",
      industry: "Government",
      am: "Allan",
      score: 74,
      arCount: 1,
      lastTouch: { date: "Jan 03", type: "Email" },
      staleDays: 11,
      opportunities: [
        {
          id: "opp_wf_1",
          name: "Cluster Expansion",
          stage: "Quote",
          value: 140000,
          risk: "warm",
          closingDays: 14,
          lastActivity: "Waiting on technical confirmation"
        }
      ]
    },

    {
      id: "acct_md",
      name: "Mooring Digital",
      industry: "Manufacturing",
      am: "Allan",
      score: 61,
      arCount: 4,
      lastTouch: { date: "Dec 15", type: "Call" },
      staleDays: 24,
      opportunities: [
        {
          id: "opp_md_1",
          name: "Bid: Storage + Support",
          stage: "Discovery",
          value: 220000,
          risk: "hot",
          closingDays: 9,
          lastActivity: "No response after follow-up"
        }
      ]
    }
  ]
};

let PIPE_STATE = {
  tab: "all",          // all | closing | risk | stale
  query: "",
  groupByStage: true
};

function money(n) {
  try {
    return n.toLocaleString(undefined, { style: "currency", currency: "USD", maximumFractionDigits: 0 });
  } catch {
    return "$" + String(n);
  }
}

function flattenOpps(data) {
  const rows = [];
  data.accounts.forEach(acct => {
    (acct.opportunities || []).forEach(opp => {
      rows.push({
        ...opp,
        accountId: acct.id,
        accountName: acct.name,
        industry: acct.industry,
        am: acct.am,
        accountScore: acct.score,
        accountAR: acct.arCount,
        staleDays: acct.staleDays,
        lastTouch: acct.lastTouch
      });
    });
  });
  return rows;
}

function oppMatchesTab(opp, tab) {
  if (tab === "all") return true;
  if (tab === "closing") return (opp.closingDays ?? 9999) <= 30;
  if (tab === "risk") return (opp.risk === "hot" || opp.risk === "warm");
  if (tab === "stale") return (opp.staleDays ?? 0) >= 14;
  return true;
}

function oppMatchesQuery(opp, q) {
  if (!q) return true;
  const s = (q || "").toLowerCase();
  return (
    String(opp.name).toLowerCase().includes(s) ||
    String(opp.accountName).toLowerCase().includes(s) ||
    String(opp.stage).toLowerCase().includes(s) ||
    String(opp.am).toLowerCase().includes(s)
  );
}

function riskChip(risk) {
  // reusing your tag classes from account detail: hot / warm / cool
  const r = risk || "cool";
  const label = r.toUpperCase();
  return `<span class="tag ${r}">${label}</span>`;
}

function renderPipeline() {
  const host = document.getElementById("pipeTable");
  if (!host) return;

  const all = flattenOpps(CRM_DATA)
    .filter(o => oppMatchesTab(o, PIPE_STATE.tab))
    .filter(o => oppMatchesQuery(o, PIPE_STATE.query));

  // Table header (pipeline-specific columns)
  const head = `
    <div class="thead">
      <div>Opportunity</div>
      <div class="hide-sm">Account</div>
      <div>Stage</div>
      <div class="hide-sm">Value</div>
      <div class="hide-sm">Owner</div>
      <div class="hide-sm">Last Touch</div>
      <div class="hide-sm">Stale</div>
      <div></div>
    </div>
  `;

  // Group by stage (optional)
  if (PIPE_STATE.groupByStage) {
    const groups = {};
    all.forEach(o => {
      const k = o.stage || "Unstaged";
      (groups[k] ||= []).push(o);
    });

    const stageOrder = ["Discovery", "Quote", "PO", "Closed", "Unstaged"];
    const sortedStages = Object.keys(groups).sort((a, b) => {
      const ai = stageOrder.indexOf(a); const bi = stageOrder.indexOf(b);
      if (ai === -1 && bi === -1) return a.localeCompare(b);
      if (ai === -1) return 1;
      if (bi === -1) return -1;
      return ai - bi;
    });

    const body = sortedStages.map(stage => {
      const rows = groups[stage]
        .sort((a, b) => (b.value || 0) - (a.value || 0))
        .map(o => pipeRow(o))
        .join("");

      return `
        <div style="padding:12px 14px;border-bottom:1px solid var(--stroke);background:color-mix(in srgb, var(--surface2) 45%, transparent);">
          <strong style="font-size:12px;letter-spacing:.12em;">${stage.toUpperCase()}</strong>
          <span class="muted" style="margin-left:10px;">${groups[stage].length} deal(s)</span>
        </div>
        ${rows}
      `;
    }).join("");

    host.innerHTML = head + body;
    return;
  }

  // Flat list
  const body = all
    .sort((a, b) => (b.value || 0) - (a.value || 0))
    .map(o => pipeRow(o))
    .join("");

  host.innerHTML = head + body;
}

function pipeRow(o) {
  const stale = (o.staleDays ?? 0);
  const staleLabel = stale >= 14 ? `<span class="score-chip bad">${stale}d</span>`
                   : stale >= 7  ? `<span class="score-chip warn">${stale}d</span>`
                                 : `<span class="score-chip good">${stale}d</span>`;

  return `
    <div class="trow" role="button" tabindex="0"
         data-action="toast"
         data-message="Open deal: ${o.name} (${o.accountName})">
      <div class="cell">
        <div style="font-weight:900;">${o.name}</div>
        <div class="muted">${riskChip(o.risk)} <span style="margin-left:8px;">Closing: ${o.closingDays ?? "—"}d</span></div>
      </div>

      <div class="cell hide-sm">
        <div class="account-name" style="cursor:pointer;">${o.accountName}</div>
        <div class="muted">${o.industry || ""}</div>
      </div>

      <div class="cell"><span class="score-chip">${o.stage || "—"}</span></div>

      <div class="cell hide-sm"><strong>${money(o.value || 0)}</strong></div>

      <div class="cell hide-sm">${o.am || "—"}</div>

      <div class="cell hide-sm">
        <div class="stack">
          <div><strong>${o.lastTouch?.date || "—"}</strong></div>
          <div class="muted">${o.lastTouch?.type || ""}</div>
        </div>
      </div>

      <div class="cell hide-sm">${staleLabel}</div>

      <div class="ar-pill">${String(o.accountAR ?? 0) ? "AR: " + (o.accountAR ?? 0) : "AR: 0"}</div>
    </div>
  `;
}

/* =========================
   PIPELINE: wiring to UI
   ========================= */
function wirePipelineUI() {
  const search = document.getElementById("pipeSearch");
  if (search) {
    search.addEventListener("input", (e) => {
      PIPE_STATE.query = e.target.value || "";
      renderPipeline();
    });
  }

  document.querySelectorAll('[data-pipe-tab]').forEach(btn => {
    btn.addEventListener("click", () => {
      PIPE_STATE.tab = btn.getAttribute("data-pipe-tab") || "all";

      // visual current state like your other tabs
      document.querySelectorAll('[data-pipe-tab]').forEach(b => b.removeAttribute("aria-current"));
      btn.setAttribute("aria-current", "page");

      renderPipeline();
    });
  });

  const toggle = document.getElementById("pipeToggleGroup");
  if (toggle) {
    toggle.addEventListener("click", () => {
      PIPE_STATE.groupByStage = !PIPE_STATE.groupByStage;
      toggle.textContent = PIPE_STATE.groupByStage ? "Group: Stage" : "Group: Off";
      renderPipeline();
    });
  }
}

/**
 * IMPORTANT:
 * Call these once on page load (after DOM ready).
 * If you already have a DOMContentLoaded block, put these calls inside it.
 */
document.addEventListener("DOMContentLoaded", () => {
  wirePipelineUI();
  renderPipeline();
});

  </script>

  <script defer src="assets/js/data.js"></script>
  <script defer src="assets/js/pipeline.js"></script>
  <script defer src="assets/js/activities.js"></script>
  <script defer src="assets/js/app.js"></script>
</body>
</html>
